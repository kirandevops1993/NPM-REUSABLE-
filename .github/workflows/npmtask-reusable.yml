name: Reusable NPM Workflow

on:
  workflow_call:
    inputs:
      command:
        required: true
        type: string
      verbose:
        required: true
        type: boolean
      customCommand:
        required: true
        type: string
      customRegistry:
        required: true
        type: string
      customFeed:
        required: true
        type: string
      customEndpoint:
        required: true
        type: string
      publishRegistry:
        required: true
        type: string
      publishFeed:
        required: true
        type: string
      publishEndpoint:
        required: true
        type: string

jobs:
  npm-task:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set Up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Attempt NPM Install
        run: |
          echo "Attempting to install dependencies..."
          npm install --legacy-peer-deps npm install --force
        continue-on-error: true

      - name: Debug Dependency Conflicts
        if: failure()
        run: |
          echo "Dependency conflict detected. Reviewing logs..."
          cat /home/runner/.npm/_logs/*.log

      - name: Run NPM Command
        if: success()
        run: |
          echo "Command: ${{ inputs.command }}"
          echo "Verbose: ${{ inputs.verbose }}"
          echo "Custom Command: ${{ inputs.customCommand }}"
          echo "Custom Registry: ${{ inputs.customRegistry }}"
          echo "Custom Feed: ${{ inputs.customFeed }}"
          echo "Custom Endpoint: ${{ inputs.customEndpoint }}"
          echo "Publish Registry: ${{ inputs.publishRegistry }}"
          echo "Publish Feed: ${{ inputs.publishFeed }}"
          echo "Publish Endpoint: ${{ inputs.publishEndpoint }}"
          npm ${{ inputs.command }} --verbose=${{ inputs.verbose }}
          npm run ${{ inputs.customCommand }}
